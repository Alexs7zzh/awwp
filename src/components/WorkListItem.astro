---
import type { CollectionEntry } from 'astro:content';
import { Picture } from 'astro:assets';

interface Props {
  work: CollectionEntry<'work'>;
}

const { work } = Astro.props;
---

<li>
  <a href={`/${work.id}`}>
    <div class="work-info">
      <div class="title-year-column">
        <h3>{work.data.title}</h3>
        <p class="year">{work.data.year}</p>
      </div>
      <div class="intro-keywords-column">
        <p class="intro">{work.data.intro}</p>
        <p class="keywords">{work.data.keywords.join(', ')}</p>
      </div>
      <div class="image-list-column">
        <div class="image-list-container">
          {work.data.imgs.map(image => (
            <Picture 
              src={image.url} 
              alt={image.label} 
              formats={['avif', 'webp']}
              widths={[360, 480, 720]}
              class="list-image"
            />
          ))}
        </div>
      </div>
    </div>
  </a>
</li>

<style>
  li {
    list-style: none;
    width: 100%;
    border-bottom: 1px solid #a1a1a1;
  }

  li:last-child {
    border-bottom: none;
  }

  a {
    text-decoration: none;
    color: inherit;
    display: block;
    transition: background-color 0.2s;
    padding: 3rem 1rem;
  }
  
  /* Base styles (Mobile-first: smallest screens < 701px) */
  .work-info {
    display: grid;
    grid-template-columns: 1fr; /* Single column */
    align-items: start;
    gap: 1rem;
    width: 100%;
  }

  /* Reorder columns visually for mobile */
  .image-list-column {
    order: 1;
    min-width: 0; /* Prevent content from expanding the column */
    padding-bottom: 2rem;
  }

  .title-year-column {
    order: 2;
  }

  .intro-keywords-column {
    order: 3;
  }

  h3 {
    margin: 0 0 0.25rem 0;
    font-weight: bold;
    color: #000;
  }

  .year {
    font-size: 0.9em;
    color: #666;
  }

  .intro {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3;
    margin-bottom: 0.5rem;
  }

  .keywords {
    font-size: 0.85em;
    color: #777;
  }

  .image-list-container {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    white-space: nowrap;
    scrollbar-width: none;
    width: 100vw; /* Span full viewport width */
    position: relative; /* Needed for correct positioning with calc */
    left: 50%; /* Center the start of the container */
    transform: translateX(-50%); /* Align center to screen center */
    /* padding-left: 2rem; /* Match parent link padding */
    /* padding-right: 2rem; /* Match parent link padding */
    box-sizing: border-box; /* Include padding in width */
  }

  .image-list-container::-webkit-scrollbar {
    display: none;
  }

  .list-image {
    /* display: block; Changed to inline-block */
    display: inline-block; /* Allow horizontal alignment */
    max-height: 200px;
    width: auto;
    flex: 0 0 auto;
    vertical-align: middle; /* Align images nicely */
  }

  /* Medium screens (>= 701px) - Two-column layout */
  @media (min-width: 701px) {
    a {
      padding: 3rem 2rem;
    }

    .work-info {
      grid-template-columns: auto 50%;
      grid-template-rows: auto 1fr;
      gap: 1.5rem;
    }

    /* Reset order for larger screens */
    .title-year-column {
      grid-column: 1 / 2;
      grid-row: 1 / 2;
      order: initial; 
    }

    .intro-keywords-column {
      grid-column: 1 / 2;
      grid-row: 2 / 3;
      order: initial;
    }

    .image-list-column {
      grid-column: 2 / 3;
      grid-row: 1 / 3;
      align-self: start;
      order: initial;
      min-width: initial; /* Reset min-width */
      padding-bottom: 0;
    }
    
    .image-list-container {
      /* Reset full-width styles */
      width: auto;
      position: static;
      left: auto;
      transform: none;
      padding-left: 0;
      padding-right: 0;
      
      /* Restore non-mobile styles */
      overflow-x: visible;
      white-space: normal;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    
    .list-image {
      display: block; /* Revert to block display */
      max-height: 100px;
    }
  }

  /* Large screens (>= 1051px) - Three-column layout */
  @media (min-width: 1051px) {
    .work-info {
      grid-template-columns: 20% 30% auto;
      grid-template-rows: auto;
      gap: 3rem;
    }
    
    /* Reset grid placements for 3 columns */
    .title-year-column {
        grid-column: 1 / 2;
        grid-row: 1 / 2;
    }
    .intro-keywords-column {
        grid-column: 2 / 3;
        grid-row: 1 / 2;
    }
    .image-list-column {
        grid-column: 3 / 4;
        grid-row: 1 / 2;
    }
  }
</style>